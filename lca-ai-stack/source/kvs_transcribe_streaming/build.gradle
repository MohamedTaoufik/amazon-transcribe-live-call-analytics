plugins {
    id 'java'
}

repositories {
    flatDir {
        dirs '.'
    }
    mavenCentral()
}

task common() {
    dependencies {
        implementation 'com.amazonaws:amazon-kinesis-video-streams-parser-library:1.1.0'
        implementation 'com.amazonaws:aws-java-sdk-dynamodb:1.12.129'
        implementation 'com.amazonaws:aws-java-sdk-kinesisvideo:1.12.129'
        implementation 'com.amazonaws:aws-java-sdk-cloudwatch:1.12.129'
        implementation 'com.amazonaws:aws-java-sdk-sqs:1.12.129'

        implementation 'software.amazon.awssdk:transcribestreaming:2.17.100'

        // need this for our async clients
        implementation 'software.amazon.awssdk:netty-nio-client:2.17.100'

        // need this for logging
        implementation 'org.apache.commons:commons-lang3:3.12.0'

        // XXX implementation 'io.reactivex.rxjava2:rxjava:2.2.21'
        implementation 'org.reactivestreams:reactive-streams:1.0.3'
        implementation 'org.json:json:20211205'
        implementation 'com.fasterxml.jackson.core:jackson-databind:2.13.0'

        implementation 'org.slf4j:slf4j-api:1.7.32'
        implementation 'org.slf4j:slf4j-log4j12:1.7.32'

        /*
         this dependency addresses the following warning generated by the SDK:

         WARN  Base64:113 - JAXB is unavailable. Will fallback to SDK implementation which
         may be less performant.If you are using Java 9+, you will need to include
         javax.xml.bind:jaxb-api as a dependency.
        */
        implementation 'javax.xml.bind:jaxb-api:2.3.1'
    }
}

//Fargate Project
task buildFargate(type: Jar, dependsOn: common) {
    manifest {
        attributes(
            'Implementation-Title': 'Fargate Task Launchpoint',
            'Main-Class': 'com.amazonaws.kvstranscribestreaming.SQSProcessor',
        )
    }
    from compileJava
    from processResources
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
    duplicatesStrategy = 'exclude'
}

build.dependsOn buildFargate
